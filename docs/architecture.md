# Architecture: Smart Study & Task Assistant Bot

## 1. Общая архитектура

```
┌─────────────┐
│ Telegram    │
│ (User)      │
└─────┬───────┘
      │
┌─────▼───────┐
│ aiogram Bot │  ← thin client
└─────┬───────┘
      │ HTTP
┌─────▼─────────────────────┐
│ Django REST API           │
│                           │
│  Auth (Telegram)          │
│  Tasks / Courses / Topics │
│  Reminders                │
│  AI Service (optional)    │
│                           │
└─────┬─────────────────────┘
      │
┌─────▼───────┐
│ PostgreSQL  │
└─────┬───────┘
      │
┌─────▼───────┐
│ Redis       │
│ (Celery)    │
└─────────────┘
```

- **Telegram (User)**: пользовательский интерфейс
- **aiogram Bot**: thin client, только обработка команд и отправка запросов к API
- **Django REST API**: бизнес-логика и хранение данных
- **PostgreSQL**: основное хранилище данных
- **Redis + Celery**: планирование и отправка напоминаний


## 2. Компоненты системы

### 2.1 Backend (Django + DRF)
- Пользователи (`User`)
- Задачи (`Task`)
- Курсы (`Course`) и темы (`Topic`)
- Напоминания (`Reminder`)
- AI сервис (опционально)

**Принципы:**
- API проектируется независимо от Telegram
- Все бизнес-правила на сервере
- JWT / session-based auth для Mini Apps

### 2.2 Telegram Bot (aiogram)
- Обрабатывает команды пользователя
- Делегирует все операции на REST API
- Inline-кнопки и колбэки для действий с задачами

### 2.3 PostgreSQL
- Основная БД
- Хранение всех сущностей: Users, Tasks, Courses, Topics, Reminders
- Реляционные связи и индексы для оптимизации

### 2.4 Redis + Celery
- Планирование и отправка напоминаний
- Асинхронные задачи, работа с таймзонами
- Celery beat → периодические проверки дедлайнов


## 3. Потоки данных

1. Пользователь отправляет команду в Telegram
2. aiogram парсит команду и делает HTTP-запрос к API
3. API выполняет бизнес-логику и изменяет БД
4. API возвращает ответ боту
5. Бот отправляет сообщение пользователю
6. Напоминания планируются через Celery → Redis → Bot API


## 4. Telegram Mini Apps (опционально)
- WebApp взаимодействует через REST API
- Авторизация через Telegram `initData`
- Эндпоинты:
  - `/api/v1/webapp/tasks/`
  - `/api/v1/webapp/stats/`
- JWT или session-based auth


## 5. Docker-сервисы

- **backend** — Django REST API
- **postgres** — база данных
- **redis** — брокер для Celery
- **celery** — воркер для фоновых задач
- **bot** — aiogram bot


## 6. Принципы проектирования

- Разделение бизнес-логики и клиента (бота)
- API как единая точка доступа
- Асинхронные задачи для отправки уведомлений
- Подготовка к Mini Apps без реализации фронта
- Возможность горизонтального масштабирования бота и Celery

