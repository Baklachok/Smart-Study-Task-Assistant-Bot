# Architecture: Smart Study & Task Assistant Bot

## 1. Общая архитектура

```
┌─────────────┐
│ Telegram    │
│ (User)      │
└─────┬───────┘
      │
┌─────▼───────┐
│ aiogram Bot │  ← thin client
└─────┬───────┘
      │ HTTP
┌─────▼─────────────────────┐
│ Django REST API           │
│                           │
│  Auth (Telegram)          │
│  Tasks / Courses / Topics │
│  Reminders                │
│  Habits analytics (LLM)   │
│                           │
└─────┬─────────────────────┘
      │
┌─────▼───────┐
│ PostgreSQL  │
└─────┬───────┘
      │
┌─────▼───────┐
│ Redis       │
│ (Celery)    │
└─────┬───────┘
      │
┌─────▼──────────┐
│ bot Celery     │
│ worker         │
└─────┬──────────┘
      │
┌─────▼──────────┐
│ Telegram API   │
└────────────────┘
```

- **Telegram (User)**: пользовательский интерфейс
- **aiogram Bot**: thin client, обработка команд и интерактивного меню, запросы к API
- **Django REST API**: бизнес-логика и хранение данных (JWT)
- **PostgreSQL**: основное хранилище данных
- **Redis + Celery**: планирование напоминаний и регулярных отчётов по привычкам


## 2. Компоненты системы

### 2.1 Backend (Django + DRF)
- Пользователи (`User`)
- Задачи (`Task`)
- Курсы (`Course`) и темы (`Topic`)
- Напоминания (`Reminder`)

**Принципы:**
- API проектируется независимо от Telegram
- Все бизнес-правила на сервере
- JWT

### 2.2 Telegram Bot (aiogram)
- Обрабатывает команды пользователя и интерактивное меню
- Делегирует все операции на REST API
- Inline-кнопки и колбэки для действий с задачами
- Отправка уведомлений выполняется Celery-воркером бота

### 2.3 PostgreSQL
- Основная БД
- Хранение всех сущностей: Users, Tasks, Courses, Topics, Reminders
- Реляционные связи и индексы для оптимизации

### 2.4 Redis + Celery
- Планирование и публикация напоминаний в очередь
- Асинхронные задачи, работа с таймзонами
- Celery beat → периодические проверки дедлайнов и привычек
- Bot worker → отправка сообщений в Telegram


## 3. Потоки данных

1. Пользователь отправляет команду в Telegram
2. aiogram парсит команду и делает HTTP-запрос к API
3. API выполняет бизнес-логику и изменяет БД
4. API возвращает ответ боту
5. Бот отправляет сообщение пользователю
6. Напоминания и отчёты публикуются через Celery → Redis → bot worker → Telegram API


## 4. Docker-сервисы

- **backend** — Django REST API
- **postgres** — база данных
- **redis** — брокер для Celery
- **celery_worker** — воркер для фоновых задач backend
- **celery_beat** — планировщик периодических задач
- **flower** — мониторинг Celery
- **bot** — aiogram bot + Celery worker для уведомлений


## 5. Принципы проектирования

- Разделение бизнес-логики и клиента (бота)
- API как единая точка доступа
- Асинхронные задачи для отправки уведомлений
- Возможность горизонтального масштабирования бота и Celery
